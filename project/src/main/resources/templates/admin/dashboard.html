<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <title>Admin Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
    <style>
      .notification-badge {
        font-size: 0.75rem;
        padding: 0.25em 0.5em;
        min-width: 1.5em;
        line-height: 1.2;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/admin/dashboard}">Admin Panel</a>
        <div class="navbar-nav ms-auto">
          <a class="nav-link" th:href="@{/}">Home</a>
          <a class="nav-link" href="javascript: document.logoutForm.submit()">Logout</a>
        </div>
      </div>
    </nav>

    <div class="container mt-5">
      <h1 class="text-center mb-5">Admin Dashboard</h1>
      <p class="text-center">Hello, <span sec:authentication="name"></span>!</p>

      <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>

      <div class="row mb-4">
        <div class="col-md-3">
          <div class="card text-center border-primary">
            <div class="card-body">
              <h5 class="card-title text-primary">Total Products</h5>
              <h2 class="text-primary" th:text="${totalProducts}">0</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center border-success">
            <div class="card-body">
              <h5 class="card-title text-success">Total Users</h5>
              <h2 class="text-success" th:text="${totalUsers}">0</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center border-info">
            <div class="card-body">
              <h5 class="card-title text-info">Total Orders</h5>
              <h2 class="text-info" th:text="${totalOrders}">0</h2>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-center border-warning">
            <div class="card-body">
              <h5 class="card-title text-warning">Total Revenue</h5>
              <h2 class="text-warning" th:text="'$' + ${#numbers.formatDecimal(totalRevenue, 0, 'COMMA', 2, 'POINT')}">$0.00</h2>
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-6">
          <div class="card text-center border-warning">
            <div class="card-body">
              <h5 class="card-title text-warning">Pending Orders</h5>
              <h2 class="text-warning" th:text="${pendingOrders}">0</h2>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card text-center border-success">
            <div class="card-body">
              <h5 class="card-title text-success">Delivered Orders</h5>
              <h2 class="text-success" th:text="${deliveredOrders}">0</h2>
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">
              <h5>Quick Actions</h5>
            </div>
            <div class="card-body">
              <a th:href="@{/admin/products}" class="btn btn-primary me-2">Manage Products</a>
              <a th:href="@{/admin/users}" class="btn btn-primary me-2">Manage Users</a>
              <a th:href="@{/admin/orders}" class="btn btn-primary me-2">Manage Orders</a>
              <a th:href="@{/admin/contacts}" class="btn btn-primary me-2 position-relative">
                Manage Contacts
                <span th:if="${unreadContacts > 0}" 
                      class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger notification-badge"
                      style="font-size: 0.7rem; padding: 0.25em 0.5em; min-width: 1.5em;"
                      th:text="${unreadContacts}">
                </span>
              </a>
              <a th:href="@{/admin/about}" class="btn btn-primary me-2">Manage About</a>
              <a th:href="@{/admin/contact-info}" class="btn btn-primary">Manage Contact Info</a>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">
              <h5>Recent Orders</h5>
            </div>
            <div class="card-body">
              <div th:if="${recentOrders == null || recentOrders.isEmpty()}" class="text-center py-4">
                <p class="text-muted">No orders yet.</p>
              </div>
              <table th:unless="${recentOrders == null || recentOrders.isEmpty()}" class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>Order ID</th>
                    <th>User</th>
                    <th>Date</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:each="order : ${recentOrders}">
                    <td th:text="${order.id}"></td>
                    <td th:text="${order.user.username}"></td>
                    <td th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}"></td>
                    <td th:text="'$' + ${#numbers.formatDecimal(order.totalPrice, 0, 'COMMA', 2, 'POINT')}"></td>
                    <td>
                      <span class="badge" 
                            th:classappend="${order.status.name() == 'PENDING' ? 'bg-warning' : 
                                          (order.status.name() == 'DELIVERED' ? 'bg-success' : 
                                          (order.status.name() == 'CANCELLED' ? 'bg-danger' : 'bg-info'))}"
                            th:text="${order.status}"></span>
                    </td>
                    <td>
                      <a th:href="@{/admin/orders/{id}(id=${order.id})}" class="btn btn-sm btn-outline-primary">View</a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <form
      name="logoutForm"
      th:action="@{/logout}"
      method="post"
      th:hidden="true"
    ></form>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
