<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <title>Admin Dashboard</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/admin/dashboard}">Admin Panel</a>
        <div class="navbar-nav ms-auto">
          <a class="nav-link" th:href="@{/admin/dashboard}">Home</a>
          <a class="nav-link" href="javascript: document.logoutForm.submit()">Logout</a>
        </div>
      </div>
    </nav>

    <div class="container mt-5">
      <h1 class="text-center mb-5">Admin Dashboard</h1>
      <p class="text-center">Hello, <span sec:authentication="name"></span>!</p>

      <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>

      <div class="row mb-4">
        <div class="col-md-4">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title">Total Products</h5>
              <h2 th:text="${totalProducts}"></h2>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title">Total Users</h5>
              <h2 th:text="${totalUsers}"></h2>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-center">
            <div class="card-body">
              <h5 class="card-title">Total Orders</h5>
              <h2 th:text="${totalOrders}"></h2>
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">
              <h5>Quick Actions</h5>
            </div>
            <div class="card-body">
              <a th:href="@{/admin/products}" class="btn btn-primary me-2">Manage Products</a>
              <a th:href="@{/admin/users}" class="btn btn-primary me-2">Manage Users</a>
              <a th:href="@{/admin/orders}" class="btn btn-primary">Manage Orders</a>
            </div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-12">
          <div class="card">
            <div class="card-header">
              <h5>Recent Orders</h5>
            </div>
            <div class="card-body">
              <table class="table">
                <thead>
                  <tr>
                    <th>Order ID</th>
                    <th>User</th>
                    <th>Date</th>
                    <th>Total</th>
                    <th>Status</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:each="order : ${recentOrders}">
                    <td th:text="${order.id}"></td>
                    <td th:text="${order.user.username}"></td>
                    <td th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}"></td>
                    <td th:text="'$' + ${#numbers.formatDecimal(order.totalPrice, 0, 'COMMA', 2, 'POINT')}"></td>
                    <td>
                      <span class="badge" 
                            th:classappend="${order.status.name() == 'PENDING' ? 'bg-warning' : 
                                          (order.status.name() == 'DELIVERED' ? 'bg-success' : 
                                          (order.status.name() == 'CANCELLED' ? 'bg-danger' : 'bg-info'))}"
                            th:text="${order.status}"></span>
                    </td>
                    <td>
                      <a th:href="@{/admin/orders/{id}(id=${order.id})}" class="btn btn-sm btn-outline-primary">View</a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <form
      name="logoutForm"
      th:action="@{/logout}"
      method="post"
      th:hidden="true"
    ></form>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
